<beans
	xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:camel="http://camel.apache.org/schema/spring"
	xsi:schemaLocation="
		http://camel.apache.org/schema/spring https://camel.apache.org/schema/spring/camel-spring.xsd
		http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd"
>

	<bean id="syncAsyncBridge" class="net.maxf.apache.camel.SyncAsyncBridge">
		 <property name="replyTo" value="{{env:REPLY_TO}}?{{env:PRODUCER_OPTS}}" />
	</bean>
	
	<camelContext xmlns="http://camel.apache.org/schema/spring" trace="true">

		<route id="reply">
			<from uri="{{env:REPLY_TO}}?{{env:CONSUMER_OPTS}}" />
			<bean ref="syncAsyncBridge" method="notifyOfReply"/>
		</route>
			
		<route id="request">
			<from uri="jetty:http://0.0.0.0:3101/sync" />
			<bean ref="syncAsyncBridge" method="queueForReply"/>
			<to uri="{{env:PRODUCER_START}}" />
			<bean ref="syncAsyncBridge" method="waitForReply"/>
		</route>

		<route id="replyTo">
			<from uri="{{env:DONE}}?{{env:CONSUMER_OPTS}}" />
			<toD uri="${header.reply-to}" />
		</route>

	</camelContext>

</beans>
